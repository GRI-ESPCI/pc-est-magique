{% extends "base.html" %} {% import "_form.html" as wtf %} {% block scripts %} 

{{ super() }} 
<script src="{{url_for("static", filename="js/sort-table.js") }}" defer>
 </script>
<script src="{{url_for("static", filename="js/club_q/club_q.js") }}" defer>
</script>
{% endblock %}{% block app_content %} {% include 'club_q/admin/common.html'
%}


<h4>{{ _("Voeux : ")}}</h4>

<div class="row">
  <div class="col table-responsive">
    <table class="table table-striped table-hover table-bordered">
      <thead>
        <tr>
          <th scope="col" onclick="sort('id');">
            <span class="d-flex user-select-none">
              <span>{{ _("ID") }}</span>
              <span class="mx-auto">
                <svg class="bi flex-shrink-0" width="16" height="16" id="sort-svg-id">
                  <!-- Sort button inserted through JS -->
                </svg>
              </span>
            </span>
          </th>
          <th scope="col" onclick="sort('spect');">
            <span class="d-flex user-select-none">
              <span>{{ _("Spectacle") }}</span>
              <span class="mx-auto">
                <svg class="bi flex-shrink-0" width="16" height="16" id="sort-svg-spect">
                  <!-- Sort button inserted through JS -->
                </svg>
              </span>
            </span>
          </th>
          <th scope="col" onclick="sort('pceen');">
            <span class="d-flex user-select-none">
              <span>{{ _("PCéens") }}</span>
              <span class="mx-auto">
                <svg class="bi flex-shrink-0" width="16" height="16" id="sort-svg-pceen">
                  <!-- Sort button inserted through JS -->
                </svg>
              </span>
            </span>
          </th>
          <th scope="col" onclick="sort('priority');">
            <span class="d-flex user-select-none">
              <span>{{ _("Priorité") }}</span>
              <span class="mx-auto">
                <svg class="bi flex-shrink-0" width="16" height="16" id="sort-svg-priority">
                  <!-- Sort button inserted through JS -->
                </svg>
              </span>
            </span>
          </th>
          <th scope="col" onclick="sort('asked');">
            <span class="d-flex user-select-none">
              <span>{{ _("Demandées") }}</span>
              <span class="mx-auto">
                <svg class="bi flex-shrink-0" width="16" height="16" id="sort-svg-asked">
                  <!-- Sort button inserted through JS -->
                </svg>
              </span>
            </span>
          </th>
          <th scope="col" onclick="sort('min');">
            <span class="d-flex user-select-none">
              <span>{{ _("Minimum") }}</span>
              <span class="mx-auto">
                <svg class="bi flex-shrink-0" width="16" height="16" id="sort-svg-min">
                  <!-- Sort button inserted through JS -->
                </svg>
              </span>
            </span>
          </th>
          <th scope="col" onclick="sort('given');">
            <span class="d-flex user-select-none">
              <span>{{ _("Attribuées") }}</span>
              <span class="mx-auto">
                <svg class="bi flex-shrink-0" width="16" height="16" id="sort-svg-given">
                  <!-- Sort button inserted through JS -->
                </svg>
              </span>
            </span>
          </th>
          <th scope="col" onclick="sort('total');">
            <span class="d-flex user-select-none">
              <span>{{ _("Prix total") }}</span>
              <span class="mx-auto">
                <svg class="bi flex-shrink-0" width="16" height="16" id="sort-svg-total">
                  <!-- Sort button inserted through JS -->
                </svg>
              </span>
            </span>
          </th>
          <th class="centered" scope="col">
            <div class="centered-content">
              <span>
                <svg class="bi flex-shrink-0" width="22" height="22">{{ macros.bootstrap_icon("wrench") }}</svg>
              </span>
            </div>
          </th>          
        </tr>
      </thead>

      <tbody id="sort-table">
        {% for voeu in voeux %}
        <tr
          data-id="{{ str(voeu.id).rjust(5, '0') }}"
          data-spect="{{ voeu.spectacle.nom }}"
          data-pceen="{{ voeu.pceen.username }}"
          data-priority="{{ str(voeu.priorite).rjust(5, '0') }}"
          data-asked="{{ voeu.places_demandees }}"
          data-min="{{ voeu.places_minimum }}"
          data-given="{{ voeu.places_attribuees }}"
          data-total="{{ str(voeu.spectacle.unit_price * voeu.places_attribuees).rjust(5, '0') }}">
          <td>{{ voeu.id }}</td>
          <td>{{ voeu.spectacle.nom }}</td>
          <td>{{ voeu.pceen.username }}</td>
          <td>{{ voeu.priorite }}</td>
          <td>{{ voeu.places_demandees }}</td>
          <td>{{ voeu.places_minimum }}</td>
          <td>{{ voeu.places_attribuees }}</td>
          <td>{{ babel.format_currency(voeu.spectacle.unit_price * voeu.places_attribuees, "EUR") }}</td>
          <td>
            <button
              class="btn btn-outline-danger p-1 pt-0"
              data-bs-target="#mo-voeu-edit"
              data-bs-toggle="modal"
              data-voeu-id="{{ voeu.id }}"
              data-voeu-spectacle="{{ voeu.spectacle.nom }}"
              data-voeu-pceen="{{ voeu.pceen.full_name }}"
              data-voeu-priorite="{{ voeu.priorite }}"
              data-voeu-places-demandees="{{ voeu.places_demandees }}"
              data-voeu-places-minimum="{{ voeu.places_minimum }}"
              data-voeu-places-attribuees="{{ voeu.places_attribuees }}"
            >
              <svg class="bi flex-shrink-0" width="18" height="18">{{ macros.bootstrap_icon("pen") }}</svg>
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>



<!-- Voeu edit modal -->
<div class="modal fade" id="mo-voeu-edit" tabindex="-1" aria-labelledby="mo-voeu-edit" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="mo-voeu-edit">
              {{ _("Editer voeu") }} {{"{voeu_id}"}} - {{"{voeu_spectacle_nom}"}} - {{"{voeu_pceen_nom}"}}
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ _("Fermer") }}"></button>
        </div>
        <form action="" method="post" role="form">
          {{ form_edit_voeu.hidden_tag() }}
          <div class="modal-body">
            <div class="row mb-3"><div class="col">
              <div class="form-floating">
                  {{ wtf.form_field(form_edit_voeu.priorite) }}
              </div>
          </div></div>
          <div class="row mb-3"><div class="col">
            <div class="form-floating">
                {{ wtf.form_field(form_edit_voeu.places_demandees) }}
            </div>
        </div></div>
        <div class="row mb-3"><div class="col">
          <div class="form-floating">
              {{ wtf.form_field(form_edit_voeu.places_minimum) }}
          </div>
      </div></div>
      <div class="row mb-3"><div class="col">
        <div class="form-floating">
            {{ wtf.form_field(form_edit_voeu.places_attribuees) }}
        </div>
    </div></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ _("Annuler") }}</button>
            <button type="button" class="btn btn-danger" id="delete-voeu-btn">
              {{ _("Supprimer") }}
            </button>
            {{ form_edit_voeu.submit(class="btn btn-primary") }}
          </div>
        </form>
    </div></div>
  </div>




{% endblock %}