{% extends "base.html" %} {% import "_form.html" as wtf %}{% block scripts %} {{ super() }}
<script
  src="{{url_for('static', filename='js/club_q/voeux.js') }}"
  defer
></script>

{% endblock %} {% block app_content %} {% include 'club_q/common.html' %}
<div class="row mb-3">
  <div class="col">
    <h3>{{ title }}</h3>
  </div>
</div>

<br />

<div class="col-2 d-flex">
  <img
    src="/club_q_images/{{spectacle.season.nom }}/{{ spectacle.image_name }}.jpg"
    alt="{{ spectacle.nom }}"
    class="img-thumbnail"
  />
</div>

<br />
<div>{{ spectacle.description }}</div>
<br />

<h4>{{ _("Informations : ")}}</h4>

<ul>
  <li>{{ _("Saison : ")}} {{ spectacle.season.nom}}</li>
  <li>{{ _("Salle : ")}} {{ spectacle.salle.nom}}</li>
  <li>{{ _("Catégorie : ")}} {{ spectacle.categorie}}</li>
  <li>{{ _("Date : ")}} {{ spectacle.date}}</li>
  <li>
    {{ _("Prix : ")}} {{ babel.format_currency(spectacle.unit_price, "EUR") }}
  </li>
  {% if has_permission(PermissionType.write, PermissionScope.club_q) %}
  <li>{{ _("Nombre tickets : ")}} {{ spectacle.nb_tickets}}</li>
  <li>{{ _("Places demandées : ")}} {{ spectacle.sum_places_demandees}}</li>
  <li>{{ _("Places attribuées : ")}} {{ spectacle.sum_places_attribuees}}</li>
  {% endif %}
</ul>
{% if has_permission(PermissionType.write, PermissionScope.club_q) %}
<h4>{{ _("Voeux : ")}}</h4>

<div class="row">
  <div class="col table-responsive">
    <table class="table table-striped table-hover table-bordered">
      <thead>
        <tr>
          <th scope="col">{{ _("ID") }}</th>
          <th scope="col">{{ _("Pcéen") }}</th>
          <th scope="col">{{ _("Priorité") }}</th>
          <th scope="col">{{ _("Demandées") }}</th>
          <th scope="col">{{ _("Minimum") }}</th>
          <th scope="col">{{ _("Attribuées") }}</th>
          <th scope="col">{{ _("Prix total") }}</th>
        </tr>
      </thead>

      <tbody>
        {% for voeu in voeux %}
        <tr
          onclick="window.location='{{ url_for('club_q.pceen_id', id=voeu.pceen.id) }}';"
        >
          <td>{{ voeu.id }}</td>
          <td>{{ voeu.pceen.full_name }}</td>
          <td>{{ voeu.priorite }}</td>
          <td>{{ voeu.places_demandees }}</td>
          <td>{{ voeu.places_minimum }}</td>
          <td>{{ voeu.places_attribuees }}</td>
          <td>
            {{ babel.format_currency(spectacle.unit_price *
            voeu.places_attribuees, "EUR") }}
          </td>
        </tr>
        {% endfor %}
        <tr>
          <td><b>{{ _("Total") }}</b></td>
          <td><b>{{ _("-") }}</b></td>
          <td><b>{{ _("-") }}</b></td>
          <td><b>{{ spectacle.sum_places_demandees }}</b></td>
          <td><b>{{ _("-") }}</b></td>
          <td><b>{{ spectacle.sum_places_attribuees }}</b></td>
          <td>
            <b
              >{{
              babel.format_currency(spectacle.unit_price*spectacle.sum_places_attribuees,
              "EUR") }}</b
            >
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<br />
<br />
<div style="display: flex">
  <a class="btn btn-primary " style="margin-right: 10px;" href="{{
  url_for("club_q.spect_generate_pdf", id = spectacle.id) }}"> {{ _("Générer le
  PDF") }} </a> <a class="btn btn-primary" href="{{
  url_for("club_q.spect_generate_excel", id = spectacle.id) }}"> {{ _("Générer
  l'Excel") }} </a>
</div>
{% endif %}
<br />
<br />

<iframe
  width="100%"
  height="400px"
  src="https://www.openstreetmap.org/export/embed.html?bbox={{spectacle.salle.longitude+0.005}}%2C{{spectacle.salle.latitude+0.0015}}%2C{{spectacle.salle.longitude-0.005}}%2C{{spectacle.salle.latitude-0.0015}}&amp;layer=mapnik&amp;marker={{spectacle.salle.latitude}}%2C{{spectacle.salle.longitude}}"
  style="border: 1px solid black"
></iframe>


<!-- Modals -->

{% include 'club_q/modals/modals_voeux.html' %} 
{% endblock %}
